
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../pam/">
      
      
        <link rel="next" href="../td/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.9">
    
    
      
        <title>Postural Transition Detection - KielMotionAnalysisToolbox</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../style.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="light-green" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#postural-transition-detection-pham" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="KielMotionAnalysisToolbox" class="md-header__button md-logo" aria-label="KielMotionAnalysisToolbox" data-md-component="logo">
      
  <img src="../../kielmat_logo_transBG.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            KielMotionAnalysisToolbox
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Postural Transition Detection
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="light-green" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="blue-grey"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../examples/" class="md-tabs__link">
          
  
  Examples

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../dataclass/" class="md-tabs__link">
        
  
    
  
  Dataclass

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  Modules

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../datasets/" class="md-tabs__link">
          
  
  Datasets

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../utils/" class="md-tabs__link">
          
  
  Utilities

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../faq/" class="md-tabs__link">
        
  
    
  
  FAQ / Troubleshooting

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../contributing/" class="md-tabs__link">
          
  
  Contributing

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="KielMotionAnalysisToolbox" class="md-nav__button md-logo" aria-label="KielMotionAnalysisToolbox" data-md-component="logo">
      
  <img src="../../kielmat_logo_transBG.png" alt="logo">

    </a>
    KielMotionAnalysisToolbox
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/basic_01_load_Data_into_KielMAT/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Load data into KielMAT
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/basic_02_load_dataset/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Load datasets
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/basic_03_events/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Events in dataclass
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/modules_04_gsd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gait Sequence Detection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/modules_05_icd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Initial Contact Detection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/modules_06_pam/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Physical Activity Monitoring
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/modules_07_ptd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Postural Transition Detection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/modules_08_td/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Turn Detection
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dataclass/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dataclass
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Modules
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gsd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gait Sequence Detection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../icd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Initial Contact Detection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pam/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Physical Activity Monitoring
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Postural Transition Detection
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Postural Transition Detection
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#postural-transition-detection-pham" class="md-nav__link">
    <span class="md-ellipsis">
      Postural Transition Detection (Pham)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modules.ptd._pham.PhamPosturalTransitionDetection" class="md-nav__link">
    <span class="md-ellipsis">
      PhamPosturalTransitionDetection
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modules.ptd._pham.PhamPosturalTransitionDetection.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modules.ptd._pham.PhamPosturalTransitionDetection.detect" class="md-nav__link">
    <span class="md-ellipsis">
      detect
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modules.ptd._pham.PhamPosturalTransitionDetection.spatio_temporal_parameters" class="md-nav__link">
    <span class="md-ellipsis">
      spatio_temporal_parameters
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../td/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Turn Detection
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Datasets
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Datasets
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../datasets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../datasets/keepcontrol/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    KeepControl
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../datasets/mobilised/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mobilise-D
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Utilities
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Utilities
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/preprocessing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Preprocessing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/importers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Import
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/orientation_estimation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Orientation Estimation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAQ / Troubleshooting
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Contributing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#postural-transition-detection-pham" class="md-nav__link">
    <span class="md-ellipsis">
      Postural Transition Detection (Pham)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modules.ptd._pham.PhamPosturalTransitionDetection" class="md-nav__link">
    <span class="md-ellipsis">
      PhamPosturalTransitionDetection
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modules.ptd._pham.PhamPosturalTransitionDetection.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modules.ptd._pham.PhamPosturalTransitionDetection.detect" class="md-nav__link">
    <span class="md-ellipsis">
      detect
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modules.ptd._pham.PhamPosturalTransitionDetection.spatio_temporal_parameters" class="md-nav__link">
    <span class="md-ellipsis">
      spatio_temporal_parameters
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Postural Transition Detection</h1>

<h2 id="postural-transition-detection-pham">Postural Transition Detection (Pham)</h2>


<div class="doc doc-object doc-class">



<a id="modules.ptd._pham.PhamPosturalTransitionDetection"></a>
    <div class="doc doc-contents first">


        <p>This algorithm aims to detect postural transitions (e.g., sit to stand or stand to sit movements)
using accelerometer and gyroscope data collected from a lower back inertial measurement unit (IMU)
sensor based on [1].</p>
<p>The algorithm is designed to be robust in detecting postural transitions using inertial sensor data
and provides detailed information about these transitions. It starts by loading the accelerometer and
gyro data, which includes three columns corresponding to the acceleration and gyro signals across
the x, y, and z axes, along with the sampling frequency of the data. It first checks the validity of
the input data. Then, it calculates the sampling period, selects accelerometer and gyro data. Then, it uses
a Versatile Quaternion-based Filter (VQF) to estimate the orientation of the IMU [2]. This helps in correcting
the orientation of accelerometer and gyroscope data. Tilt angle estimation is performed using gyro data in
lateral or anteroposterior direction which represent movements or rotations in the mediolateral direction.
The tilt angle is decomposed using wavelet transformation to identify stationary periods. Stationary periods
are detected using accelerometer variance and gyro variance. Then, peaks in the wavelet-transformed
tilt signal are detected as potential postural transition events.</p>
<p>If there's enough stationary data, further processing is done to estimate the orientation using
quaternions and to identify the beginning and end of postural transitions using gyro data. Otherwise,
if there's insufficient stationary data, direction changes in gyro data are used to infer postural
transitions. Finally, the detected postural transitions along with their characteristics (onset, duration, etc.)
are stored in a pandas DataFrame (postural_transitions_ attribute).</p>
<p>In addition, spatial-temporal parameters are calculated using detected postural transitions and their
characteristics by the spatio_temporal_parameters method. As a return, the postural transition id along
with its spatial-temporal parameters including type of postural transition (sit to stand or stand to sit),
angle of postural transition, maximum flexion velocity, and maximum extension velocity are stored in a pandas
DataFrame (parameters_ attribute).</p>
<p>If requested (plot_results set to True), it generates plots of the accelerometer and gyroscope data
along with the detected postural transitions.</p>


<p><span class="doc-section-title">Methods:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="detect(accel_data, gyro_data, sampling_freq_Hz, dt_data=None, tracking_system=None, tracked_point=None, plot_results=False) (modules.ptd._pham.PhamPosturalTransitionDetection.detect)" href="#modules.ptd._pham.PhamPosturalTransitionDetection.detect">detect</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Detects  sit to stand and stand to sit using accelerometer and gyro signals.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="spatio_temporal_parameters() (modules.ptd._pham.PhamPosturalTransitionDetection.spatio_temporal_parameters)" href="#modules.ptd._pham.PhamPosturalTransitionDetection.spatio_temporal_parameters">spatio_temporal_parameters</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Extracts spatio-temporal parameters of the detected turns.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">pham</span> <span class="o">=</span> <span class="n">PhamPosturalTransitionDetection</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pham</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span>
<span class="go">        accel_data=accel_data,</span>
<span class="go">        gyro_data=gyro_data,</span>
<span class="go">        sampling_freq_Hz=200.0,</span>
<span class="go">        tracking_system=&quot;imu&quot;,</span>
<span class="go">        tracked_point=&quot;LowerBack&quot;,</span>
<span class="go">        plot_results=False</span>
<span class="go">        )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">pham</span><span class="o">.</span><span class="n">postural_transitions_</span><span class="p">)</span>
<span class="go">        onset      duration     event_type              tracking_systems    tracked_points</span>
<span class="go">    0   17.895     1.8          postural transition     imu                 LowerBack</span>
<span class="go">    1   54.655     1.9          postural transition     imu                 LowerBack</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">pham</span><span class="o">.</span><span class="n">spatio_temporal_parameters</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">pham</span><span class="o">.</span><span class="n">parameters_</span><span class="p">)</span>
<span class="go">        type of postural transition    angle of postural transition     maximum flexion velocity    maximum extension velocity</span>
<span class="go">    0   sit to stand                   53.26                            79                          8</span>
<span class="go">    1   stand to sit                   47.12                            91                      120</span>
</code></pre></div>


<details class="references" open>
  <summary>References</summary>
  <p>[1] Pham et al. (2018). Validation of a Lower Back "Wearable"-Based Sit-to-Stand and Stand-to-Sit Algorithm... https://doi.org/10.3389/fneur.2018.00652
[2] D. Laidig and T. Seel. â€œVQF: Highly Accurate IMU Orientation Estimation with Bias Estimation ... https://doi.org/10.1016/j.inffus.2022.10.014</p>
</details>






              <details class="quote">
                <summary>Source code in <code>kielmat/modules/ptd/_pham.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">PhamPosturalTransitionDetection</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This algorithm aims to detect postural transitions (e.g., sit to stand or stand to sit movements)</span>
<span class="sd">    using accelerometer and gyroscope data collected from a lower back inertial measurement unit (IMU)</span>
<span class="sd">    sensor based on [1].</span>

<span class="sd">    The algorithm is designed to be robust in detecting postural transitions using inertial sensor data</span>
<span class="sd">    and provides detailed information about these transitions. It starts by loading the accelerometer and</span>
<span class="sd">    gyro data, which includes three columns corresponding to the acceleration and gyro signals across</span>
<span class="sd">    the x, y, and z axes, along with the sampling frequency of the data. It first checks the validity of</span>
<span class="sd">    the input data. Then, it calculates the sampling period, selects accelerometer and gyro data. Then, it uses</span>
<span class="sd">    a Versatile Quaternion-based Filter (VQF) to estimate the orientation of the IMU [2]. This helps in correcting</span>
<span class="sd">    the orientation of accelerometer and gyroscope data. Tilt angle estimation is performed using gyro data in</span>
<span class="sd">    lateral or anteroposterior direction which represent movements or rotations in the mediolateral direction.</span>
<span class="sd">    The tilt angle is decomposed using wavelet transformation to identify stationary periods. Stationary periods</span>
<span class="sd">    are detected using accelerometer variance and gyro variance. Then, peaks in the wavelet-transformed</span>
<span class="sd">    tilt signal are detected as potential postural transition events.</span>

<span class="sd">    If there&#39;s enough stationary data, further processing is done to estimate the orientation using</span>
<span class="sd">    quaternions and to identify the beginning and end of postural transitions using gyro data. Otherwise,</span>
<span class="sd">    if there&#39;s insufficient stationary data, direction changes in gyro data are used to infer postural</span>
<span class="sd">    transitions. Finally, the detected postural transitions along with their characteristics (onset, duration, etc.)</span>
<span class="sd">    are stored in a pandas DataFrame (postural_transitions_ attribute).</span>

<span class="sd">    In addition, spatial-temporal parameters are calculated using detected postural transitions and their</span>
<span class="sd">    characteristics by the spatio_temporal_parameters method. As a return, the postural transition id along</span>
<span class="sd">    with its spatial-temporal parameters including type of postural transition (sit to stand or stand to sit),</span>
<span class="sd">    angle of postural transition, maximum flexion velocity, and maximum extension velocity are stored in a pandas</span>
<span class="sd">    DataFrame (parameters_ attribute).</span>

<span class="sd">    If requested (plot_results set to True), it generates plots of the accelerometer and gyroscope data</span>
<span class="sd">    along with the detected postural transitions.</span>

<span class="sd">    Methods:</span>
<span class="sd">        detect(accel_data, gyro_data, sampling_freq_Hz, dt_data, tracking_system, tracked_point, plot_results):</span>
<span class="sd">            Detects  sit to stand and stand to sit using accelerometer and gyro signals.</span>

<span class="sd">        spatio_temporal_parameters():</span>
<span class="sd">            Extracts spatio-temporal parameters of the detected turns.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; pham = PhamPosturalTransitionDetection()</span>
<span class="sd">        &gt;&gt;&gt; pham.detect(</span>
<span class="sd">                accel_data=accel_data,</span>
<span class="sd">                gyro_data=gyro_data,</span>
<span class="sd">                sampling_freq_Hz=200.0,</span>
<span class="sd">                tracking_system=&quot;imu&quot;,</span>
<span class="sd">                tracked_point=&quot;LowerBack&quot;,</span>
<span class="sd">                plot_results=False</span>
<span class="sd">                )</span>
<span class="sd">        &gt;&gt;&gt; print(pham.postural_transitions_)</span>
<span class="sd">                onset      duration     event_type              tracking_systems    tracked_points</span>
<span class="sd">            0   17.895     1.8          postural transition     imu                 LowerBack</span>
<span class="sd">            1   54.655     1.9          postural transition     imu                 LowerBack</span>

<span class="sd">        &gt;&gt;&gt; pham.spatio_temporal_parameters()</span>
<span class="sd">        &gt;&gt;&gt; print(pham.parameters_)</span>
<span class="sd">                type of postural transition    angle of postural transition     maximum flexion velocity    maximum extension velocity</span>
<span class="sd">            0   sit to stand                   53.26                            79                          8</span>
<span class="sd">            1   stand to sit                   47.12                            91                      120</span>

<span class="sd">    References:</span>
<span class="sd">        [1] Pham et al. (2018). Validation of a Lower Back &quot;Wearable&quot;-Based Sit-to-Stand and Stand-to-Sit Algorithm... https://doi.org/10.3389/fneur.2018.00652</span>
<span class="sd">        [2] D. Laidig and T. Seel. â€œVQF: Highly Accurate IMU Orientation Estimation with Bias Estimation ... https://doi.org/10.1016/j.inffus.2022.10.014</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">cutoff_freq_hz</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">,</span>
        <span class="n">thr_accel_var</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
        <span class="n">thr_gyro_var</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">10e-2</span><span class="p">,</span>
        <span class="n">min_postural_transition_angle_deg</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">15.0</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the PhamPosturalTransitionDetection instance.</span>

<span class="sd">        Args:</span>
<span class="sd">            cutoff_freq_hz (float, optional): Cutoff frequency for low-pass Butterworth filer. Default is 5.0.</span>
<span class="sd">            thr_accel_var (float): Threshold value for identifying periods where the acceleartion variance is low. Default is 0.5.</span>
<span class="sd">            thr_gyro_var (float): Threshold value for identifying periods where the gyro variance is low. Default is 2e-4.</span>
<span class="sd">            min_postural_transition_angle_deg (float): Minimum angle which is considered as postural transition in degrees. Default is 15.0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_freq_hz</span> <span class="o">=</span> <span class="n">cutoff_freq_hz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thr_accel_var</span> <span class="o">=</span> <span class="n">thr_accel_var</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thr_gyro_var</span> <span class="o">=</span> <span class="n">thr_gyro_var</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_postural_transition_angle_deg</span> <span class="o">=</span> <span class="n">min_postural_transition_angle_deg</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">detect</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">accel_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">gyro_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">sampling_freq_Hz</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">dt_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tracking_system</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tracked_point</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">plot_results</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Detects postural transitions based on the input accelerometer and gyro data.</span>

<span class="sd">        Args:</span>
<span class="sd">            accel_data (pd.DataFrame): Input accelerometer data (N, 3) for x, y, and z axes.</span>
<span class="sd">            gyro_data (pd.DataFrame): Input gyro data (N, 3) for x, y, and z axes.</span>
<span class="sd">            sampling_freq_Hz (float): Sampling frequency of the input data.</span>
<span class="sd">            dt_data (pd.Series, optional): Original datetime in the input data. If original datetime is provided, the output onset will be based on that.</span>
<span class="sd">            tracking_system (str, optional): Tracking systems.</span>
<span class="sd">            tracked_point (str, optional): Tracked points on the body.</span>
<span class="sd">            plot_results (bool, optional): If True, generates a plot. Default is False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The postural transition information is stored in the &#39;postural_transitions_&#39; attribute, which is a pandas DataFrame in BIDS format with the following columns:</span>

<span class="sd">                - onset: Start time of the postural transition in second.</span>
<span class="sd">                - duration: Duration of the postural transition in second.</span>
<span class="sd">                - event_type: Type of the event which is postural transition.</span>
<span class="sd">                - tracking_systems: Name of the tracking systems.</span>
<span class="sd">                - tracked_points: Name of the tracked points on the body.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check if dt_data is a pandas Series with datetime values</span>
        <span class="k">if</span> <span class="n">dt_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Ensure dt_data is a pandas Series</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dt_data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;dt_data must be a pandas Series with datetime values&quot;</span><span class="p">)</span>

            <span class="c1"># Ensure dt_data has datetime values</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_datetime64_any_dtype</span><span class="p">(</span><span class="n">dt_data</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;dt_data must be a pandas Series with datetime values&quot;</span><span class="p">)</span>

            <span class="c1"># Ensure dt_data has the same length as accel_data and gyro_data</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dt_data</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">accel_data</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;dt_data must be a pandas Series with the same length as accel_data and gyro_data&quot;</span>
                <span class="p">)</span>

        <span class="c1"># Check if data is a DataFrame</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">accel_data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Input data must be a pandas DataFrame&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gyro_data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Input data must be a pandas DataFrame&quot;</span><span class="p">)</span>

        <span class="c1"># Error handling for invalid input data</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">accel_data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="ow">or</span> <span class="n">accel_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Input accelerometer data must be a DataFrame with 3 columns for x, y, and z axes.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gyro_data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="ow">or</span> <span class="n">gyro_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Input gyro data must be a DataFrame with 3 columns for x, y, and z axes.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Check if sampling frequency is positive</span>
        <span class="k">if</span> <span class="n">sampling_freq_Hz</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Sampling frequency must be positive&quot;</span><span class="p">)</span>

        <span class="c1"># Check if plot_results is a boolean</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">plot_results</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;plot_results must be a boolean value&quot;</span><span class="p">)</span>

        <span class="c1"># Calculate sampling period</span>
        <span class="n">sampling_period</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">sampling_freq_Hz</span>

        <span class="n">gyro_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">gyro_data</span><span class="p">)</span>

        <span class="c1"># Ensure that acceleration and gyroscope arrays are C-contiguous for efficient processing</span>
        <span class="n">accel_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">accel_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gyro_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">gyro_data</span><span class="p">)</span>

        <span class="c1"># Initialize the Versatile Quaternion-based Filter (VQF) with the calculated sampling period</span>
        <span class="n">vqf</span> <span class="o">=</span> <span class="n">VQF</span><span class="p">(</span><span class="n">sampling_period</span><span class="p">)</span>

        <span class="c1"># Perform orientation estimation using VQF</span>
        <span class="c1"># This step estimates the orientation of the IMU and returns quaternion-based orientation estimates</span>
        <span class="n">out_orientation_est</span> <span class="o">=</span> <span class="n">vqf</span><span class="o">.</span><span class="n">updateBatch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gyro_data</span><span class="p">,</span> <span class="n">accel_data</span><span class="p">)</span>

        <span class="c1"># Initialize arrays to store the updated acceleration and gyroscope data</span>
        <span class="n">accel_updated</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">accel_data</span><span class="p">)</span>
        <span class="n">gyro_updated</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gyro_data</span><span class="p">)</span>

        <span class="c1"># Apply quaternion-based orientation correction to the accelerometer data</span>
        <span class="c1"># This step corrects the accelerometer data based on the estimated orientation</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">accel_updated</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">accel_updated</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">vqf</span><span class="o">.</span><span class="n">quatRotate</span><span class="p">(</span>
                <span class="n">out_orientation_est</span><span class="p">[</span><span class="s2">&quot;quat6D&quot;</span><span class="p">][</span><span class="n">t</span><span class="p">,</span> <span class="p">:],</span> <span class="n">accel_data</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="p">:]</span>
            <span class="p">)</span>

        <span class="c1"># Apply quaternion-based orientation correction to the gyroscope data</span>
        <span class="c1"># This step corrects the gyroscope data based on the estimated orientation</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">gyro_updated</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">gyro_updated</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">vqf</span><span class="o">.</span><span class="n">quatRotate</span><span class="p">(</span>
                <span class="n">out_orientation_est</span><span class="p">[</span><span class="s2">&quot;quat6D&quot;</span><span class="p">][</span><span class="n">t</span><span class="p">,</span> <span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">gyro_data</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="p">:]</span>
            <span class="p">)</span>

        <span class="c1"># Convert updated acceleration data back from &quot;m/s^2&quot; to &quot;g&quot; units</span>
        <span class="c1"># This step reverses the initial conversion applied to the acceleration data</span>
        <span class="n">accel</span> <span class="o">=</span> <span class="n">accel_updated</span> <span class="o">/</span> <span class="mf">9.81</span>

        <span class="c1"># Convert back gyro data from rad/s to deg/s after orientation estimation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gyro</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">gyro_updated</span><span class="p">)</span>

        <span class="c1"># Compute the range of gyro signals for x and y components</span>
        <span class="n">range_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gyro</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>  <span class="c1"># gyro x-axis</span>
        <span class="n">range_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gyro</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>  <span class="c1"># gyro y-axis</span>

        <span class="c1"># Compute the variance of gyro signals for x and y components</span>
        <span class="n">var_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gyro</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>  <span class="c1"># gyro x-axis</span>
        <span class="n">var_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gyro</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>  <span class="c1"># gyro y-axis</span>

        <span class="c1"># Determine which component of gyro corresponds to the mediolateral direction</span>
        <span class="k">if</span> <span class="n">range_x</span> <span class="o">&gt;</span> <span class="n">range_y</span> <span class="ow">or</span> <span class="n">var_x</span> <span class="o">&gt;</span> <span class="n">var_y</span><span class="p">:</span>
            <span class="c1"># X component has a larger range/variance, likely mediolateral</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gyro_mediolateral</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gyro</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># Gyro x-axis is mediolateral</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Y component has a larger range/variance, likely mediolateral</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gyro_mediolateral</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gyro</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># Gyro y-axis is mediolateral</span>

        <span class="c1"># Calculate timestamps to use in next calculation</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">accel</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sampling_period</span>

        <span class="c1"># Estimate tilt angle in deg</span>
        <span class="n">tilt_angle_deg</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">tilt_angle_estimation</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gyro_mediolateral</span><span class="p">,</span> <span class="n">sampling_frequency_hz</span><span class="o">=</span><span class="n">sampling_freq_Hz</span>
        <span class="p">)</span>

        <span class="c1"># Convert tilt angle to rad</span>
        <span class="n">tilt_angle_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">tilt_angle_deg</span><span class="p">)</span>

        <span class="c1"># Calculate sine of the tilt angle in radians</span>
        <span class="n">tilt_sin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">tilt_angle_rad</span><span class="p">)</span>

        <span class="c1"># Apply wavelet decomposition with level of 3</span>
        <span class="n">tilt_dwt_3</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">wavelet_decomposition</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="n">tilt_sin</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">wavetype</span><span class="o">=</span><span class="s2">&quot;coif5&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Apply wavelet decomposition with level of 10</span>
        <span class="n">tilt_dwt_10</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">wavelet_decomposition</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="n">tilt_sin</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">wavetype</span><span class="o">=</span><span class="s2">&quot;coif5&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Calculate difference</span>
        <span class="n">tilt_dwt</span> <span class="o">=</span> <span class="n">tilt_dwt_3</span> <span class="o">-</span> <span class="n">tilt_dwt_10</span>

        <span class="c1"># Find peaks in denoised tilt signal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">local_peaks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span>
            <span class="n">tilt_dwt</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="mf">0.2</span>
        <span class="p">)</span>

        <span class="c1"># Calculate the norm of acceleration</span>
        <span class="n">accel_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">accel</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">accel</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">accel</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Calculate absolute value of the acceleration signal</span>
        <span class="n">accel_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">accel_norm</span><span class="p">)</span>

        <span class="c1"># Detect stationary parts of the signal based on the deifned threshold</span>
        <span class="n">stationary_1</span> <span class="o">=</span> <span class="n">accel_norm</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">thr_accel_var</span>
        <span class="n">stationary_1</span> <span class="o">=</span> <span class="p">(</span><span class="n">stationary_1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="c1"># Compute the variance of the moving window acceleration</span>
        <span class="n">accel_var</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">moving_var</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">accel_norm</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="n">sampling_freq_Hz</span><span class="p">)</span>

        <span class="c1"># Calculate stationary_2 from acceleration variance</span>
        <span class="n">stationary_2</span> <span class="o">=</span> <span class="p">(</span><span class="n">accel_var</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thr_gyro_var</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="c1"># Calculate stationary of gyro variance</span>
        <span class="n">gyro_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gyro</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gyro</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gyro</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="p">)</span>

        <span class="c1"># Compute the variance of the moving window of gyro</span>
        <span class="n">gyro_var</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">moving_var</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">gyro_norm</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="n">sampling_freq_Hz</span><span class="p">)</span>

        <span class="c1"># Calculate stationary of gyro variance</span>
        <span class="n">stationary_3</span> <span class="o">=</span> <span class="p">(</span><span class="n">gyro_var</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thr_gyro_var</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="c1"># Perform stationarity checks</span>
        <span class="n">stationary</span> <span class="o">=</span> <span class="n">stationary_1</span> <span class="o">&amp;</span> <span class="n">stationary_2</span> <span class="o">&amp;</span> <span class="n">stationary_3</span>

        <span class="c1"># Remove consecutive True values in the stationary array</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stationary</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">stationary</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">stationary</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">stationary</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Set initial period and check if enough stationary data is available</span>
        <span class="c1"># Stationary periods are defined as the episodes when the lower back of the participant was almost not moving and not rotating.</span>
        <span class="c1"># The thresholds are determined based on the training data set.</span>
        <span class="n">init_period</span> <span class="o">=</span> <span class="mf">0.1</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">stationary</span><span class="p">[:</span> <span class="nb">int</span><span class="p">(</span><span class="n">sampling_freq_Hz</span> <span class="o">*</span> <span class="n">init_period</span><span class="p">)])</span> <span class="o">&gt;=</span> <span class="mi">200</span>
        <span class="p">):</span>  <span class="c1"># If the process is stationary in the first 2s</span>
            <span class="c1"># If there is enough stationary data, perform sensor fusion using accelerometer and gyro data</span>
            <span class="p">(</span>
                <span class="n">postural_transition_onset</span><span class="p">,</span>
                <span class="n">postural_transition_type</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">postural_transition_angle</span><span class="p">,</span>
                <span class="n">duration</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">flexion_max_vel</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">extension_max_vel</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">process_postural_transitions_stationary_periods</span><span class="p">(</span>
                <span class="n">time</span><span class="p">,</span>
                <span class="n">accel</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gyro</span><span class="p">,</span>
                <span class="n">stationary</span><span class="p">,</span>
                <span class="n">tilt_angle_deg</span><span class="p">,</span>
                <span class="n">sampling_period</span><span class="p">,</span>
                <span class="n">sampling_freq_Hz</span><span class="p">,</span>
                <span class="n">init_period</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">local_peaks</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Create a DataFrame with postural transition information</span>
            <span class="n">postural_transitions_</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;onset&quot;</span><span class="p">:</span> <span class="n">postural_transition_onset</span><span class="p">,</span>
                    <span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="n">duration</span><span class="p">,</span>
                    <span class="s2">&quot;event_type&quot;</span><span class="p">:</span> <span class="n">postural_transition_type</span><span class="p">,</span>
                    <span class="s2">&quot;tracking_systems&quot;</span><span class="p">:</span> <span class="n">tracking_system</span><span class="p">,</span>
                    <span class="s2">&quot;tracked_points&quot;</span><span class="p">:</span> <span class="n">tracked_point</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Handle cases where there is not enough stationary data</span>
            <span class="c1"># Find indices where the product of consecutive changes sign, indicating a change in direction</span>
            <span class="n">iZeroCr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gyro_mediolateral</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">gyro_mediolateral</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">&lt;</span> <span class="mi">0</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># Calculate the difference between consecutive values</span>
            <span class="n">gyro_y_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gyro_mediolateral</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="c1"># Initialize arrays to store left and right indices for each local peak</span>
            <span class="c1"># Initialize left side indices with ones</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">left_side</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">local_peaks</span><span class="p">)</span>

            <span class="c1"># Initialize right side indices with length of gyro data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">right_side</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gyro_mediolateral</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">local_peaks</span>
            <span class="p">)</span>

            <span class="c1"># Loop through each local peak</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">local_peaks</span><span class="p">)):</span>
                <span class="c1"># Get the index of the current local peak</span>
                <span class="n">postural_transitions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_peaks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                <span class="c1"># Calculate distances to all zero-crossing points relative to the peak</span>
                <span class="n">dist2peak</span> <span class="o">=</span> <span class="n">iZeroCr</span> <span class="o">-</span> <span class="n">postural_transitions</span>

                <span class="c1"># Extract distances to zero-crossing points on the left side of the peak</span>
                <span class="n">dist2peak_left_side</span> <span class="o">=</span> <span class="n">dist2peak</span><span class="p">[</span><span class="n">dist2peak</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span>

                <span class="c1"># Extract distances to zero-crossing points on the right side of the peak</span>
                <span class="n">dist2peak_right_side</span> <span class="o">=</span> <span class="n">dist2peak</span><span class="p">[</span><span class="n">dist2peak</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>

                <span class="c1"># Iterate over distances to zero-crossing points on the left side of the peak (in reverse order)</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dist2peak_left_side</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                    <span class="c1"># Check if slope is down and the left side not too close to the peak (more than 200ms)</span>
                    <span class="k">if</span> <span class="n">gyro_y_diff</span><span class="p">[</span>
                        <span class="n">postural_transitions</span> <span class="o">+</span> <span class="n">dist2peak_left_side</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="o">-</span><span class="n">dist2peak_left_side</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mf">0.2</span> <span class="o">*</span> <span class="n">sampling_freq_Hz</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="c1"># If the left side peak is far enough or small enough</span>
                            <span class="k">if</span> <span class="p">(</span>
                                <span class="n">dist2peak_left_side</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">dist2peak_left_side</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                            <span class="p">)</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mf">0.2</span> <span class="o">*</span> <span class="n">sampling_freq_Hz</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
                                <span class="n">tilt_angle_deg</span><span class="p">[</span>
                                    <span class="n">postural_transitions</span> <span class="o">+</span> <span class="n">dist2peak_left_side</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                                <span class="p">]</span>
                                <span class="o">-</span> <span class="n">tilt_angle_deg</span><span class="p">[</span>
                                    <span class="n">postural_transitions</span> <span class="o">+</span> <span class="n">dist2peak_left_side</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                                <span class="p">]</span>
                            <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="c1"># Store the index of the left side</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">left_side</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                                    <span class="n">postural_transitions</span> <span class="o">+</span> <span class="n">dist2peak_left_side</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                                <span class="p">)</span>
                                <span class="k">break</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">left_side</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                                    <span class="n">postural_transitions</span> <span class="o">+</span> <span class="n">dist2peak_left_side</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                                <span class="p">)</span>
                                <span class="k">break</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dist2peak_right_side</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">gyro_y_diff</span><span class="p">[</span>
                        <span class="n">postural_transitions</span> <span class="o">+</span> <span class="n">dist2peak_right_side</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">dist2peak_right_side</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mf">0.2</span> <span class="o">*</span> <span class="n">sampling_freq_Hz</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">right_side</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">postural_transitions</span> <span class="o">+</span> <span class="n">dist2peak_right_side</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                        <span class="p">)</span>
                        <span class="k">break</span>

                <span class="c1"># Calculate postural transition angle</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">postural_transition_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
                    <span class="n">tilt_angle_deg</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">local_peaks</span><span class="p">]</span> <span class="o">-</span> <span class="n">tilt_angle_deg</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">left_side</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_side</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">postural_transition_angle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span>
                        <span class="n">tilt_angle_deg</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">local_peaks</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                        <span class="o">-</span> <span class="n">tilt_angle_deg</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">right_side</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="p">)</span>

                <span class="c1"># Calculate duration of each postural transition</span>
                <span class="n">duration</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">right_side</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_side</span><span class="p">)</span> <span class="o">/</span> <span class="n">sampling_freq_Hz</span>

                <span class="c1"># Convert peak times to integers</span>
                <span class="n">postural_transition_onset</span> <span class="o">=</span> <span class="n">time</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">local_peaks</span><span class="p">]</span>

        <span class="c1"># Remove too small postural transitions</span>
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">postural_transition_angle</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_postural_transition_angle_deg</span>
        <span class="n">postural_transition_onset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_side</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">sampling_freq_Hz</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="n">duration</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="c1"># Check if dt_data is provided for datetime conversion</span>
        <span class="k">if</span> <span class="n">dt_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Convert onset times to datetime format</span>
            <span class="n">starting_datetime</span> <span class="o">=</span> <span class="n">dt_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span>
                <span class="mi">0</span>
            <span class="p">]</span>  <span class="c1"># Assuming dt_data is aligned with the signal data</span>
            <span class="n">postural_transition_onset</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">starting_datetime</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">postural_transition_onset</span>
            <span class="p">]</span>

        <span class="c1"># Create a DataFrame with postural transition information</span>
        <span class="n">postural_transitions_</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;onset&quot;</span><span class="p">:</span> <span class="n">postural_transition_onset</span><span class="p">,</span>
                <span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="n">duration</span><span class="p">,</span>
                <span class="s2">&quot;event_type&quot;</span><span class="p">:</span> <span class="s2">&quot;postural transition&quot;</span><span class="p">,</span>
                <span class="s2">&quot;tracking_systems&quot;</span><span class="p">:</span> <span class="n">tracking_system</span><span class="p">,</span>
                <span class="s2">&quot;tracked_points&quot;</span><span class="p">:</span> <span class="n">tracked_point</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># Assign the DataFrame to the &#39;postural_transitions_&#39; attribute</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">postural_transitions_</span> <span class="o">=</span> <span class="n">postural_transitions_</span>

        <span class="c1"># If Plot_results set to true</span>
        <span class="k">if</span> <span class="n">plot_results</span><span class="p">:</span>
            <span class="n">viz_utils</span><span class="o">.</span><span class="n">plot_postural_transitions</span><span class="p">(</span>
                <span class="n">accel</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gyro</span><span class="p">,</span>
                <span class="n">postural_transitions_</span><span class="p">,</span>
                <span class="n">sampling_freq_Hz</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Return an instance of the class</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">spatio_temporal_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extracts spatio-temporal parameters of the detected postural transitions.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The spatio-temporal parameter information is stored in the &#39;spatio_temporal_parameters&#39; attribute, which is a pandas DataFrame as:</span>

<span class="sd">                - type_of_postural_transition: Type of postural transition which is either &quot;sit to stand&quot; or &quot;stand to sit&quot;.</span>
<span class="sd">                - angel_of_postural_transition: Angle of the postural transition in degrees.</span>
<span class="sd">                - maximum_flexion_velocity: Maximum flexion velocity in deg/s.</span>
<span class="sd">                - maximum_extension_velocity: Maximum extension velocity in deg/s.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">postural_transitions_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;No postural transition detected. Please run the detect method first.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Initialize list for postural transition types</span>
        <span class="n">postural_transition_type</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Distinguish between different types of postural transitions</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">local_peaks</span><span class="p">)):</span>
            <span class="n">gyro_temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gyro_mediolateral</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">left_side</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_side</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
            <span class="n">min_peak</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">gyro_temp</span><span class="p">)</span>
            <span class="n">max_peak</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">gyro_temp</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">max_peak</span><span class="p">)</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">min_peak</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span>
                <span class="n">postural_transition_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;sit to stand&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">postural_transition_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;stand to sit&quot;</span><span class="p">)</span>

        <span class="c1"># Postural transition type and angle determination</span>
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">postural_transition_angle</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_postural_transition_angle_deg</span>
        <span class="n">postural_transition_type</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">postural_transition_type</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">postural_transition_type</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">postural_transition_angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">postural_transition_angle</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="c1"># Calculate maximum flexion velocity and maximum extension velocity</span>
        <span class="n">flexion_max_vel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">local_peaks</span><span class="p">)</span>
        <span class="n">extension_max_vel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">local_peaks</span><span class="p">)</span>

        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">local_peaks</span><span class="p">)):</span>
            <span class="n">flexion_max_vel</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gyro_mediolateral</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">left_side</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_peaks</span><span class="p">[</span><span class="nb">id</span><span class="p">]])</span>
            <span class="p">)</span>
            <span class="n">extension_max_vel</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gyro_mediolateral</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">local_peaks</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_side</span><span class="p">[</span><span class="nb">id</span><span class="p">]])</span>
            <span class="p">)</span>

        <span class="c1"># Filter the velocities based on valid indices</span>
        <span class="n">flexion_max_vel</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">flexion_max_vel</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">flexion_max_vel</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="p">]</span>

        <span class="c1"># Calculate maximum extension velocity</span>
        <span class="n">extension_max_vel</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">extension_max_vel</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">extension_max_vel</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="p">]</span>

        <span class="c1"># Create a DataFrame with the calculated spatio-temporal parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters_</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;type_of_postural_transition&quot;</span><span class="p">:</span> <span class="n">postural_transition_type</span><span class="p">,</span>
                <span class="s2">&quot;angle_of_postural_transition&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">postural_transition_angle</span><span class="p">,</span>
                <span class="s2">&quot;maximum_flexion_velocity&quot;</span><span class="p">:</span> <span class="n">flexion_max_vel</span><span class="p">,</span>
                <span class="s2">&quot;maximum_extension_velocity&quot;</span><span class="p">:</span> <span class="n">extension_max_vel</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># Set the index name to &#39;postural transition id&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters_</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;postural transition id&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="modules.ptd._pham.PhamPosturalTransitionDetection.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">cutoff_freq_hz</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">thr_accel_var</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">thr_gyro_var</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">min_postural_transition_angle_deg</span><span class="o">=</span><span class="mf">15.0</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initializes the PhamPosturalTransitionDetection instance.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cutoff_freq_hz</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cutoff frequency for low-pass Butterworth filer. Default is 5.0.</p>
              </div>
            </td>
            <td>
                  <code>5.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>thr_accel_var</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Threshold value for identifying periods where the acceleartion variance is low. Default is 0.5.</p>
              </div>
            </td>
            <td>
                  <code>0.05</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>thr_gyro_var</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Threshold value for identifying periods where the gyro variance is low. Default is 2e-4.</p>
              </div>
            </td>
            <td>
                  <code>0.1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_postural_transition_angle_deg</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum angle which is considered as postural transition in degrees. Default is 15.0.</p>
              </div>
            </td>
            <td>
                  <code>15.0</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>kielmat/modules/ptd/_pham.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">cutoff_freq_hz</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">,</span>
    <span class="n">thr_accel_var</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
    <span class="n">thr_gyro_var</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">10e-2</span><span class="p">,</span>
    <span class="n">min_postural_transition_angle_deg</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">15.0</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initializes the PhamPosturalTransitionDetection instance.</span>

<span class="sd">    Args:</span>
<span class="sd">        cutoff_freq_hz (float, optional): Cutoff frequency for low-pass Butterworth filer. Default is 5.0.</span>
<span class="sd">        thr_accel_var (float): Threshold value for identifying periods where the acceleartion variance is low. Default is 0.5.</span>
<span class="sd">        thr_gyro_var (float): Threshold value for identifying periods where the gyro variance is low. Default is 2e-4.</span>
<span class="sd">        min_postural_transition_angle_deg (float): Minimum angle which is considered as postural transition in degrees. Default is 15.0.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_freq_hz</span> <span class="o">=</span> <span class="n">cutoff_freq_hz</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">thr_accel_var</span> <span class="o">=</span> <span class="n">thr_accel_var</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">thr_gyro_var</span> <span class="o">=</span> <span class="n">thr_gyro_var</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">min_postural_transition_angle_deg</span> <span class="o">=</span> <span class="n">min_postural_transition_angle_deg</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="modules.ptd._pham.PhamPosturalTransitionDetection.detect" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">detect</span><span class="p">(</span><span class="n">accel_data</span><span class="p">,</span> <span class="n">gyro_data</span><span class="p">,</span> <span class="n">sampling_freq_Hz</span><span class="p">,</span> <span class="n">dt_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tracking_system</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tracked_point</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot_results</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Detects postural transitions based on the input accelerometer and gyro data.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>accel_data</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input accelerometer data (N, 3) for x, y, and z axes.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gyro_data</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input gyro data (N, 3) for x, y, and z axes.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sampling_freq_Hz</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sampling frequency of the input data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dt_data</code>
            </td>
            <td>
                  <code><span title="pandas.Series">Series</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Original datetime in the input data. If original datetime is provided, the output onset will be based on that.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tracking_system</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tracking systems.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tracked_point</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tracked points on the body.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>plot_results</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, generates a plot. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The postural transition information is stored in the 'postural_transitions_' attribute, which is a pandas DataFrame in BIDS format with the following columns:</p>
<ul>
<li>onset: Start time of the postural transition in second.</li>
<li>duration: Duration of the postural transition in second.</li>
<li>event_type: Type of the event which is postural transition.</li>
<li>tracking_systems: Name of the tracking systems.</li>
<li>tracked_points: Name of the tracked points on the body.</li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>kielmat/modules/ptd/_pham.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">detect</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">accel_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">gyro_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">sampling_freq_Hz</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">dt_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">tracking_system</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">tracked_point</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">plot_results</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Detects postural transitions based on the input accelerometer and gyro data.</span>

<span class="sd">    Args:</span>
<span class="sd">        accel_data (pd.DataFrame): Input accelerometer data (N, 3) for x, y, and z axes.</span>
<span class="sd">        gyro_data (pd.DataFrame): Input gyro data (N, 3) for x, y, and z axes.</span>
<span class="sd">        sampling_freq_Hz (float): Sampling frequency of the input data.</span>
<span class="sd">        dt_data (pd.Series, optional): Original datetime in the input data. If original datetime is provided, the output onset will be based on that.</span>
<span class="sd">        tracking_system (str, optional): Tracking systems.</span>
<span class="sd">        tracked_point (str, optional): Tracked points on the body.</span>
<span class="sd">        plot_results (bool, optional): If True, generates a plot. Default is False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The postural transition information is stored in the &#39;postural_transitions_&#39; attribute, which is a pandas DataFrame in BIDS format with the following columns:</span>

<span class="sd">            - onset: Start time of the postural transition in second.</span>
<span class="sd">            - duration: Duration of the postural transition in second.</span>
<span class="sd">            - event_type: Type of the event which is postural transition.</span>
<span class="sd">            - tracking_systems: Name of the tracking systems.</span>
<span class="sd">            - tracked_points: Name of the tracked points on the body.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># check if dt_data is a pandas Series with datetime values</span>
    <span class="k">if</span> <span class="n">dt_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Ensure dt_data is a pandas Series</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dt_data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;dt_data must be a pandas Series with datetime values&quot;</span><span class="p">)</span>

        <span class="c1"># Ensure dt_data has datetime values</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_datetime64_any_dtype</span><span class="p">(</span><span class="n">dt_data</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;dt_data must be a pandas Series with datetime values&quot;</span><span class="p">)</span>

        <span class="c1"># Ensure dt_data has the same length as accel_data and gyro_data</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dt_data</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">accel_data</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;dt_data must be a pandas Series with the same length as accel_data and gyro_data&quot;</span>
            <span class="p">)</span>

    <span class="c1"># Check if data is a DataFrame</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">accel_data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Input data must be a pandas DataFrame&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gyro_data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Input data must be a pandas DataFrame&quot;</span><span class="p">)</span>

    <span class="c1"># Error handling for invalid input data</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">accel_data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="ow">or</span> <span class="n">accel_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Input accelerometer data must be a DataFrame with 3 columns for x, y, and z axes.&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gyro_data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="ow">or</span> <span class="n">gyro_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Input gyro data must be a DataFrame with 3 columns for x, y, and z axes.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Check if sampling frequency is positive</span>
    <span class="k">if</span> <span class="n">sampling_freq_Hz</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Sampling frequency must be positive&quot;</span><span class="p">)</span>

    <span class="c1"># Check if plot_results is a boolean</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">plot_results</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;plot_results must be a boolean value&quot;</span><span class="p">)</span>

    <span class="c1"># Calculate sampling period</span>
    <span class="n">sampling_period</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">sampling_freq_Hz</span>

    <span class="n">gyro_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">gyro_data</span><span class="p">)</span>

    <span class="c1"># Ensure that acceleration and gyroscope arrays are C-contiguous for efficient processing</span>
    <span class="n">accel_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">accel_data</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gyro_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">gyro_data</span><span class="p">)</span>

    <span class="c1"># Initialize the Versatile Quaternion-based Filter (VQF) with the calculated sampling period</span>
    <span class="n">vqf</span> <span class="o">=</span> <span class="n">VQF</span><span class="p">(</span><span class="n">sampling_period</span><span class="p">)</span>

    <span class="c1"># Perform orientation estimation using VQF</span>
    <span class="c1"># This step estimates the orientation of the IMU and returns quaternion-based orientation estimates</span>
    <span class="n">out_orientation_est</span> <span class="o">=</span> <span class="n">vqf</span><span class="o">.</span><span class="n">updateBatch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gyro_data</span><span class="p">,</span> <span class="n">accel_data</span><span class="p">)</span>

    <span class="c1"># Initialize arrays to store the updated acceleration and gyroscope data</span>
    <span class="n">accel_updated</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">accel_data</span><span class="p">)</span>
    <span class="n">gyro_updated</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gyro_data</span><span class="p">)</span>

    <span class="c1"># Apply quaternion-based orientation correction to the accelerometer data</span>
    <span class="c1"># This step corrects the accelerometer data based on the estimated orientation</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">accel_updated</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">accel_updated</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">vqf</span><span class="o">.</span><span class="n">quatRotate</span><span class="p">(</span>
            <span class="n">out_orientation_est</span><span class="p">[</span><span class="s2">&quot;quat6D&quot;</span><span class="p">][</span><span class="n">t</span><span class="p">,</span> <span class="p">:],</span> <span class="n">accel_data</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="p">:]</span>
        <span class="p">)</span>

    <span class="c1"># Apply quaternion-based orientation correction to the gyroscope data</span>
    <span class="c1"># This step corrects the gyroscope data based on the estimated orientation</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">gyro_updated</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">gyro_updated</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">vqf</span><span class="o">.</span><span class="n">quatRotate</span><span class="p">(</span>
            <span class="n">out_orientation_est</span><span class="p">[</span><span class="s2">&quot;quat6D&quot;</span><span class="p">][</span><span class="n">t</span><span class="p">,</span> <span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">gyro_data</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="p">:]</span>
        <span class="p">)</span>

    <span class="c1"># Convert updated acceleration data back from &quot;m/s^2&quot; to &quot;g&quot; units</span>
    <span class="c1"># This step reverses the initial conversion applied to the acceleration data</span>
    <span class="n">accel</span> <span class="o">=</span> <span class="n">accel_updated</span> <span class="o">/</span> <span class="mf">9.81</span>

    <span class="c1"># Convert back gyro data from rad/s to deg/s after orientation estimation</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gyro</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">gyro_updated</span><span class="p">)</span>

    <span class="c1"># Compute the range of gyro signals for x and y components</span>
    <span class="n">range_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gyro</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>  <span class="c1"># gyro x-axis</span>
    <span class="n">range_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gyro</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>  <span class="c1"># gyro y-axis</span>

    <span class="c1"># Compute the variance of gyro signals for x and y components</span>
    <span class="n">var_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gyro</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>  <span class="c1"># gyro x-axis</span>
    <span class="n">var_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gyro</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>  <span class="c1"># gyro y-axis</span>

    <span class="c1"># Determine which component of gyro corresponds to the mediolateral direction</span>
    <span class="k">if</span> <span class="n">range_x</span> <span class="o">&gt;</span> <span class="n">range_y</span> <span class="ow">or</span> <span class="n">var_x</span> <span class="o">&gt;</span> <span class="n">var_y</span><span class="p">:</span>
        <span class="c1"># X component has a larger range/variance, likely mediolateral</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gyro_mediolateral</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gyro</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># Gyro x-axis is mediolateral</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Y component has a larger range/variance, likely mediolateral</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gyro_mediolateral</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gyro</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># Gyro y-axis is mediolateral</span>

    <span class="c1"># Calculate timestamps to use in next calculation</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">accel</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sampling_period</span>

    <span class="c1"># Estimate tilt angle in deg</span>
    <span class="n">tilt_angle_deg</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">tilt_angle_estimation</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gyro_mediolateral</span><span class="p">,</span> <span class="n">sampling_frequency_hz</span><span class="o">=</span><span class="n">sampling_freq_Hz</span>
    <span class="p">)</span>

    <span class="c1"># Convert tilt angle to rad</span>
    <span class="n">tilt_angle_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">tilt_angle_deg</span><span class="p">)</span>

    <span class="c1"># Calculate sine of the tilt angle in radians</span>
    <span class="n">tilt_sin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">tilt_angle_rad</span><span class="p">)</span>

    <span class="c1"># Apply wavelet decomposition with level of 3</span>
    <span class="n">tilt_dwt_3</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">wavelet_decomposition</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">tilt_sin</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">wavetype</span><span class="o">=</span><span class="s2">&quot;coif5&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Apply wavelet decomposition with level of 10</span>
    <span class="n">tilt_dwt_10</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">wavelet_decomposition</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">tilt_sin</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">wavetype</span><span class="o">=</span><span class="s2">&quot;coif5&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Calculate difference</span>
    <span class="n">tilt_dwt</span> <span class="o">=</span> <span class="n">tilt_dwt_3</span> <span class="o">-</span> <span class="n">tilt_dwt_10</span>

    <span class="c1"># Find peaks in denoised tilt signal</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">local_peaks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span>
        <span class="n">tilt_dwt</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="mf">0.2</span>
    <span class="p">)</span>

    <span class="c1"># Calculate the norm of acceleration</span>
    <span class="n">accel_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">accel</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">accel</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">accel</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Calculate absolute value of the acceleration signal</span>
    <span class="n">accel_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">accel_norm</span><span class="p">)</span>

    <span class="c1"># Detect stationary parts of the signal based on the deifned threshold</span>
    <span class="n">stationary_1</span> <span class="o">=</span> <span class="n">accel_norm</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">thr_accel_var</span>
    <span class="n">stationary_1</span> <span class="o">=</span> <span class="p">(</span><span class="n">stationary_1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="c1"># Compute the variance of the moving window acceleration</span>
    <span class="n">accel_var</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">moving_var</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">accel_norm</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="n">sampling_freq_Hz</span><span class="p">)</span>

    <span class="c1"># Calculate stationary_2 from acceleration variance</span>
    <span class="n">stationary_2</span> <span class="o">=</span> <span class="p">(</span><span class="n">accel_var</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thr_gyro_var</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="c1"># Calculate stationary of gyro variance</span>
    <span class="n">gyro_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gyro</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gyro</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gyro</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="p">)</span>

    <span class="c1"># Compute the variance of the moving window of gyro</span>
    <span class="n">gyro_var</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">moving_var</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">gyro_norm</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="n">sampling_freq_Hz</span><span class="p">)</span>

    <span class="c1"># Calculate stationary of gyro variance</span>
    <span class="n">stationary_3</span> <span class="o">=</span> <span class="p">(</span><span class="n">gyro_var</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thr_gyro_var</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="c1"># Perform stationarity checks</span>
    <span class="n">stationary</span> <span class="o">=</span> <span class="n">stationary_1</span> <span class="o">&amp;</span> <span class="n">stationary_2</span> <span class="o">&amp;</span> <span class="n">stationary_3</span>

    <span class="c1"># Remove consecutive True values in the stationary array</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stationary</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">stationary</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">stationary</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">stationary</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Set initial period and check if enough stationary data is available</span>
    <span class="c1"># Stationary periods are defined as the episodes when the lower back of the participant was almost not moving and not rotating.</span>
    <span class="c1"># The thresholds are determined based on the training data set.</span>
    <span class="n">init_period</span> <span class="o">=</span> <span class="mf">0.1</span>

    <span class="k">if</span> <span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">stationary</span><span class="p">[:</span> <span class="nb">int</span><span class="p">(</span><span class="n">sampling_freq_Hz</span> <span class="o">*</span> <span class="n">init_period</span><span class="p">)])</span> <span class="o">&gt;=</span> <span class="mi">200</span>
    <span class="p">):</span>  <span class="c1"># If the process is stationary in the first 2s</span>
        <span class="c1"># If there is enough stationary data, perform sensor fusion using accelerometer and gyro data</span>
        <span class="p">(</span>
            <span class="n">postural_transition_onset</span><span class="p">,</span>
            <span class="n">postural_transition_type</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">postural_transition_angle</span><span class="p">,</span>
            <span class="n">duration</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flexion_max_vel</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extension_max_vel</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">process_postural_transitions_stationary_periods</span><span class="p">(</span>
            <span class="n">time</span><span class="p">,</span>
            <span class="n">accel</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gyro</span><span class="p">,</span>
            <span class="n">stationary</span><span class="p">,</span>
            <span class="n">tilt_angle_deg</span><span class="p">,</span>
            <span class="n">sampling_period</span><span class="p">,</span>
            <span class="n">sampling_freq_Hz</span><span class="p">,</span>
            <span class="n">init_period</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">local_peaks</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Create a DataFrame with postural transition information</span>
        <span class="n">postural_transitions_</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;onset&quot;</span><span class="p">:</span> <span class="n">postural_transition_onset</span><span class="p">,</span>
                <span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="n">duration</span><span class="p">,</span>
                <span class="s2">&quot;event_type&quot;</span><span class="p">:</span> <span class="n">postural_transition_type</span><span class="p">,</span>
                <span class="s2">&quot;tracking_systems&quot;</span><span class="p">:</span> <span class="n">tracking_system</span><span class="p">,</span>
                <span class="s2">&quot;tracked_points&quot;</span><span class="p">:</span> <span class="n">tracked_point</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Handle cases where there is not enough stationary data</span>
        <span class="c1"># Find indices where the product of consecutive changes sign, indicating a change in direction</span>
        <span class="n">iZeroCr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gyro_mediolateral</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">gyro_mediolateral</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">&lt;</span> <span class="mi">0</span>
        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Calculate the difference between consecutive values</span>
        <span class="n">gyro_y_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gyro_mediolateral</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Initialize arrays to store left and right indices for each local peak</span>
        <span class="c1"># Initialize left side indices with ones</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left_side</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">local_peaks</span><span class="p">)</span>

        <span class="c1"># Initialize right side indices with length of gyro data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_side</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gyro_mediolateral</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">local_peaks</span>
        <span class="p">)</span>

        <span class="c1"># Loop through each local peak</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">local_peaks</span><span class="p">)):</span>
            <span class="c1"># Get the index of the current local peak</span>
            <span class="n">postural_transitions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_peaks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="c1"># Calculate distances to all zero-crossing points relative to the peak</span>
            <span class="n">dist2peak</span> <span class="o">=</span> <span class="n">iZeroCr</span> <span class="o">-</span> <span class="n">postural_transitions</span>

            <span class="c1"># Extract distances to zero-crossing points on the left side of the peak</span>
            <span class="n">dist2peak_left_side</span> <span class="o">=</span> <span class="n">dist2peak</span><span class="p">[</span><span class="n">dist2peak</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span>

            <span class="c1"># Extract distances to zero-crossing points on the right side of the peak</span>
            <span class="n">dist2peak_right_side</span> <span class="o">=</span> <span class="n">dist2peak</span><span class="p">[</span><span class="n">dist2peak</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>

            <span class="c1"># Iterate over distances to zero-crossing points on the left side of the peak (in reverse order)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dist2peak_left_side</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="c1"># Check if slope is down and the left side not too close to the peak (more than 200ms)</span>
                <span class="k">if</span> <span class="n">gyro_y_diff</span><span class="p">[</span>
                    <span class="n">postural_transitions</span> <span class="o">+</span> <span class="n">dist2peak_left_side</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="o">-</span><span class="n">dist2peak_left_side</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mf">0.2</span> <span class="o">*</span> <span class="n">sampling_freq_Hz</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="c1"># If the left side peak is far enough or small enough</span>
                        <span class="k">if</span> <span class="p">(</span>
                            <span class="n">dist2peak_left_side</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">dist2peak_left_side</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="p">)</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mf">0.2</span> <span class="o">*</span> <span class="n">sampling_freq_Hz</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
                            <span class="n">tilt_angle_deg</span><span class="p">[</span>
                                <span class="n">postural_transitions</span> <span class="o">+</span> <span class="n">dist2peak_left_side</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                            <span class="p">]</span>
                            <span class="o">-</span> <span class="n">tilt_angle_deg</span><span class="p">[</span>
                                <span class="n">postural_transitions</span> <span class="o">+</span> <span class="n">dist2peak_left_side</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                            <span class="p">]</span>
                        <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="c1"># Store the index of the left side</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">left_side</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="n">postural_transitions</span> <span class="o">+</span> <span class="n">dist2peak_left_side</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                            <span class="p">)</span>
                            <span class="k">break</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">left_side</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="n">postural_transitions</span> <span class="o">+</span> <span class="n">dist2peak_left_side</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                            <span class="p">)</span>
                            <span class="k">break</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dist2peak_right_side</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">gyro_y_diff</span><span class="p">[</span>
                    <span class="n">postural_transitions</span> <span class="o">+</span> <span class="n">dist2peak_right_side</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">dist2peak_right_side</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mf">0.2</span> <span class="o">*</span> <span class="n">sampling_freq_Hz</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">right_side</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">postural_transitions</span> <span class="o">+</span> <span class="n">dist2peak_right_side</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="k">break</span>

            <span class="c1"># Calculate postural transition angle</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">postural_transition_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
                <span class="n">tilt_angle_deg</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">local_peaks</span><span class="p">]</span> <span class="o">-</span> <span class="n">tilt_angle_deg</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">left_side</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_side</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">postural_transition_angle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span>
                    <span class="n">tilt_angle_deg</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">local_peaks</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="o">-</span> <span class="n">tilt_angle_deg</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">right_side</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="p">)</span>

            <span class="c1"># Calculate duration of each postural transition</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">right_side</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_side</span><span class="p">)</span> <span class="o">/</span> <span class="n">sampling_freq_Hz</span>

            <span class="c1"># Convert peak times to integers</span>
            <span class="n">postural_transition_onset</span> <span class="o">=</span> <span class="n">time</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">local_peaks</span><span class="p">]</span>

    <span class="c1"># Remove too small postural transitions</span>
    <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">postural_transition_angle</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_postural_transition_angle_deg</span>
    <span class="n">postural_transition_onset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_side</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">sampling_freq_Hz</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="n">duration</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="c1"># Check if dt_data is provided for datetime conversion</span>
    <span class="k">if</span> <span class="n">dt_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Convert onset times to datetime format</span>
        <span class="n">starting_datetime</span> <span class="o">=</span> <span class="n">dt_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span>
            <span class="mi">0</span>
        <span class="p">]</span>  <span class="c1"># Assuming dt_data is aligned with the signal data</span>
        <span class="n">postural_transition_onset</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">starting_datetime</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">postural_transition_onset</span>
        <span class="p">]</span>

    <span class="c1"># Create a DataFrame with postural transition information</span>
    <span class="n">postural_transitions_</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;onset&quot;</span><span class="p">:</span> <span class="n">postural_transition_onset</span><span class="p">,</span>
            <span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="n">duration</span><span class="p">,</span>
            <span class="s2">&quot;event_type&quot;</span><span class="p">:</span> <span class="s2">&quot;postural transition&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tracking_systems&quot;</span><span class="p">:</span> <span class="n">tracking_system</span><span class="p">,</span>
            <span class="s2">&quot;tracked_points&quot;</span><span class="p">:</span> <span class="n">tracked_point</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="c1"># Assign the DataFrame to the &#39;postural_transitions_&#39; attribute</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">postural_transitions_</span> <span class="o">=</span> <span class="n">postural_transitions_</span>

    <span class="c1"># If Plot_results set to true</span>
    <span class="k">if</span> <span class="n">plot_results</span><span class="p">:</span>
        <span class="n">viz_utils</span><span class="o">.</span><span class="n">plot_postural_transitions</span><span class="p">(</span>
            <span class="n">accel</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gyro</span><span class="p">,</span>
            <span class="n">postural_transitions_</span><span class="p">,</span>
            <span class="n">sampling_freq_Hz</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># Return an instance of the class</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="modules.ptd._pham.PhamPosturalTransitionDetection.spatio_temporal_parameters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">spatio_temporal_parameters</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Extracts spatio-temporal parameters of the detected postural transitions.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The spatio-temporal parameter information is stored in the 'spatio_temporal_parameters' attribute, which is a pandas DataFrame as:</p>
<ul>
<li>type_of_postural_transition: Type of postural transition which is either "sit to stand" or "stand to sit".</li>
<li>angel_of_postural_transition: Angle of the postural transition in degrees.</li>
<li>maximum_flexion_velocity: Maximum flexion velocity in deg/s.</li>
<li>maximum_extension_velocity: Maximum extension velocity in deg/s.</li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>kielmat/modules/ptd/_pham.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">spatio_temporal_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts spatio-temporal parameters of the detected postural transitions.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The spatio-temporal parameter information is stored in the &#39;spatio_temporal_parameters&#39; attribute, which is a pandas DataFrame as:</span>

<span class="sd">            - type_of_postural_transition: Type of postural transition which is either &quot;sit to stand&quot; or &quot;stand to sit&quot;.</span>
<span class="sd">            - angel_of_postural_transition: Angle of the postural transition in degrees.</span>
<span class="sd">            - maximum_flexion_velocity: Maximum flexion velocity in deg/s.</span>
<span class="sd">            - maximum_extension_velocity: Maximum extension velocity in deg/s.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">postural_transitions_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;No postural transition detected. Please run the detect method first.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Initialize list for postural transition types</span>
    <span class="n">postural_transition_type</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Distinguish between different types of postural transitions</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">local_peaks</span><span class="p">)):</span>
        <span class="n">gyro_temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gyro_mediolateral</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">left_side</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_side</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
        <span class="n">min_peak</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">gyro_temp</span><span class="p">)</span>
        <span class="n">max_peak</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">gyro_temp</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">max_peak</span><span class="p">)</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">min_peak</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="n">postural_transition_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;sit to stand&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">postural_transition_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;stand to sit&quot;</span><span class="p">)</span>

    <span class="c1"># Postural transition type and angle determination</span>
    <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">postural_transition_angle</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_postural_transition_angle_deg</span>
    <span class="n">postural_transition_type</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">postural_transition_type</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">postural_transition_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">postural_transition_angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">postural_transition_angle</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="c1"># Calculate maximum flexion velocity and maximum extension velocity</span>
    <span class="n">flexion_max_vel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">local_peaks</span><span class="p">)</span>
    <span class="n">extension_max_vel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">local_peaks</span><span class="p">)</span>

    <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">local_peaks</span><span class="p">)):</span>
        <span class="n">flexion_max_vel</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
            <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gyro_mediolateral</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">left_side</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_peaks</span><span class="p">[</span><span class="nb">id</span><span class="p">]])</span>
        <span class="p">)</span>
        <span class="n">extension_max_vel</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
            <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gyro_mediolateral</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">local_peaks</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_side</span><span class="p">[</span><span class="nb">id</span><span class="p">]])</span>
        <span class="p">)</span>

    <span class="c1"># Filter the velocities based on valid indices</span>
    <span class="n">flexion_max_vel</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">flexion_max_vel</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">flexion_max_vel</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="p">]</span>

    <span class="c1"># Calculate maximum extension velocity</span>
    <span class="n">extension_max_vel</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">extension_max_vel</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">extension_max_vel</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="p">]</span>

    <span class="c1"># Create a DataFrame with the calculated spatio-temporal parameters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parameters_</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;type_of_postural_transition&quot;</span><span class="p">:</span> <span class="n">postural_transition_type</span><span class="p">,</span>
            <span class="s2">&quot;angle_of_postural_transition&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">postural_transition_angle</span><span class="p">,</span>
            <span class="s2">&quot;maximum_flexion_velocity&quot;</span><span class="p">:</span> <span class="n">flexion_max_vel</span><span class="p">,</span>
            <span class="s2">&quot;maximum_extension_velocity&quot;</span><span class="p">:</span> <span class="n">extension_max_vel</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="c1"># Set the index name to &#39;postural transition id&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parameters_</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;postural transition id&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>